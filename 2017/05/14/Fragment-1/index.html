<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  
  <title>Fragment不完全解析（一）</title>
  <meta name="author" content="Sweeney Di">
  <meta name="description" content="Fragment是在Android 3.0 (API level 11)开始引入的,它能让你的app在现有基础上性能大幅度提高，并且占用内存降低，同样的界面Activity占用内存比Fragment要多，响应速度Fragment比Activty在中低端手机上快了很多，甚至能达到好几倍,同时给大屏幕（">
  
  
  <meta property="og:title" content="Fragment不完全解析（一）"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="Sweeney Di&#39;s Blog"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="Sweeney Di&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="behind">
      <a href="/" class="back black-color">
        <svg class="i-close" viewBox="0 0 32 32" width="22" height="22" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M2 30 L30 2 M30 30 L2 2"></path>
        </svg>
      </a>
      <div class="description">
        &nbsp;I want to put a ding in the universe
      </div>
    </div>
    <div class="container">
      

  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        Fragment不完全解析（一）
    </h1>
  


    </div>
    <div class="meta center">
      
<time datetime="2017-05-13T16:00:00.000Z">
<svg class="i-calendar" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2017-05-14
</time>



    
    &nbsp;
    <svg class="i-tag" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      <circle cx="24" cy="8" r="2"></circle>
      <path d="M2 18 L18 2 30 2 30 14 14 30 Z"></path>
    </svg>
    &nbsp;
    <a href="/categories/Android/">Android</a>





    </div>
    <hr>
    <div class="picture-container">
      
    </div>
    <blockquote>
<p>Fragment是在Android 3.0 (API level 11)开始引入的,它能让你的app在现有基础上性能大幅度提高，并且占用内存降低，同样的界面Activity占用内存比Fragment要多，响应速度Fragment比Activty在中低端手机上快了很多，甚至能达到好几倍,同时给大屏幕（如平板电脑）上更加动态和灵活的 UI 设计提供支持.</p>
</blockquote>
<hr>
<h1 id="一、Fragment的生命周期"><a href="#一、Fragment的生命周期" class="headerlink" title="一、Fragment的生命周期"></a>一、Fragment的生命周期</h1><p>Fragment表示Activity中的行为或用户界面部分,其生命周期直接受宿主activity生命周期的影响。下图可以很直观反映出两者的关系：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1964096-c58ccce76a9aedf4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2" alt="Fragment VS Activity"></p>
<p>Fragment比Activity多出的几个生命周期回调方法：</p>
<ul>
<li><p><strong>onAttach(Activity)</strong>：</p>
<p> called once the fragment is associated with its activity.（当Fragment和Activity相关联调用</p>
</li>
<li><p><strong>onCreateView(LayoutInflater, ViewGroup, Bundle)</strong></p>
<p> creates and returns the view hierarchy associated with the fragment.（创建Fragment的视图</p>
</li>
<li><p><strong>onActivityCreated(Bundle)</strong></p>
<p> tells the fragment that its activity has completed its own Activity.onCreate().   （当Activity.onCreate()完成时调用</p>
</li>
<li><p><strong>onDestroyView()</strong></p>
<p>allows the fragment to clean up resources associated with its View.</p>
</li>
<li><p><strong>onDetach()</strong></p>
<p>called immediately prior to the fragment no longer being associated with its activity</p>
</li>
</ul>
<h1 id="二、Fragment-的使用"><a href="#二、Fragment-的使用" class="headerlink" title="二、Fragment 的使用"></a>二、Fragment 的使用</h1><h2 id="静态使用"><a href="#静态使用" class="headerlink" title="静态使用"></a>静态使用</h2><p>把Fragment当做普通的控件写入Activity的布局文件中，用布局文件调用Fragment，这里不再展开</p>
<h2 id="动态使用"><a href="#动态使用" class="headerlink" title="动态使用"></a>动态使用</h2><p>Fragment动态使用主要是动态添加，更新，删除.</p>
<p>在activity的布局文件中添加一个FrameLayout，作为fragment需要放入的ViewGroup</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</div><div class="line">&lt;RelativeLayout</div><div class="line">    xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"match_parent"</span></div><div class="line">    tools:context=<span class="string">"net.december1900.test.MainActivity"</span>&gt;</div><div class="line">    </div><div class="line">    &lt;FrameLayout</div><div class="line">        android:id=<span class="string">"@+id/content_layout"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"match_parent"</span>/&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure>
<p>fragment和主activity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_main,container,<span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> MainFragment mMainFragment;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        showFragment();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showFragment</span><span class="params">()</span></span>&#123;</div><div class="line">        FragmentManager manager = getSupportFragmentManager();</div><div class="line">        FragmentTransaction fragmentTransaction = manager.beginTransaction();</div><div class="line">        mMainFragment = <span class="keyword">new</span> MainFragment();</div><div class="line">        fragmentTransaction.replace(R.id.content_layout,mMainFragment);</div><div class="line">        fragmentTransaction.commit();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>显示</p>
<p><img src="http://oq8w2ddi6.bkt.clouddn.com/fragment1.png" alt=""></p>
<h2 id="Fragment常用的类"><a href="#Fragment常用的类" class="headerlink" title="Fragment常用的类"></a>Fragment常用的类</h2><ol>
<li><p>android.app.FragmentManager</p>
<p>  <strong>获取方式：getSupportFragmentManager();</strong></p>
</li>
<li><p>android.app.FragmentTransaction</p>
<p> <strong>FragmentTransaction transaction = fm.benginTransatcion();</strong></p>
<ul>
<li><p><strong>transaction.add()</strong></p>
<p> 往Activity中添加一个Fragment</p>
</li>
<li><p><strong>transaction.remove()</strong></p>
<p> 从Activity中移除一个Fragment，如果被移除的Fragment没有添加到回退栈，这个Fragment实例将会被销毁</p>
</li>
<li><p><strong>transaction.replace()</strong> </p>
<p> 使用另一个Fragment替换当前的，可以理解为remove() + add()</p>
</li>
<li><p><strong>transaction.hide()</strong></p>
<p> 隐藏当前的Fragment，仅仅是设为不可见，并不会销毁</p>
</li>
<li><p><strong>transaction.show()</strong></p>
<p> 显示之前隐藏的Fragment</p>
</li>
<li><p><strong>transatcion.commit()</strong></p>
</li>
</ul>
</li>
</ol>
<p>总结起来：</p>
<p><strong>如果你希望保留用户操作的面板，可以使用show(),hide()。其实是让Fragment的View setVisibility(true还是false)，不会调用生命周期</strong></p>
<p><strong>如果你不希望保留用户操作，可以使用replace()。其会销毁视图，即调用onDestoryView、onCreateView等一系列生命周期</strong></p>
<h1 id="三、管理Fragment的回退栈"><a href="#三、管理Fragment的回退栈" class="headerlink" title="三、管理Fragment的回退栈"></a>三、管理Fragment的回退栈</h1><p>我们可以通过Activity维护一个回退栈来保存每次Fragment事务发生的变化。如果将Fragment任务添加到回退栈，当用户点击后退按钮时，将看到上一次的保存的Fragment。一旦Fragment完全从后退栈中弹出，用户再次点击后退键，则会退出当前Activity。</p>
<p>添加一个Fragment事务到回退栈：<br>FragmentTransaction.addToBackStack(String)</p>
<p>主activity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> MainFragment mMainFragment;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        showFragment(<span class="string">"MainFragment"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showFragment</span><span class="params">(String tag)</span> </span>&#123;</div><div class="line">        FragmentManager manager = getSupportFragmentManager();</div><div class="line">        FragmentTransaction fragmentTransaction = manager.beginTransaction();</div><div class="line">        mMainFragment = <span class="keyword">new</span> MainFragment();</div><div class="line">        fragmentTransaction.add(R.id.content_layout, mMainFragment, tag);</div><div class="line">        fragmentTransaction.addToBackStack(tag);</div><div class="line">        fragmentTransaction.commit();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainFragment</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@BindView</span>(R.id.btn_main)</div><div class="line">    Button mBtnMain;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        View view = inflater.inflate(R.layout.fragment_main, container, <span class="keyword">false</span>);</div><div class="line">        ButterKnife.bind(<span class="keyword">this</span>, view);</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@OnClick</span>(R.id.btn_main)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewClicked</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        showFragment(<span class="string">"SecondFragment"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showFragment</span><span class="params">(String tag)</span> </span>&#123;</div><div class="line">        SecondFragment secondFragment = <span class="keyword">new</span> SecondFragment();</div><div class="line">        FragmentManager manager = getFragmentManager();</div><div class="line">        FragmentTransaction transaction = manager.beginTransaction();</div><div class="line">        transaction.replace(R.id.content_layout, secondFragment, tag);</div><div class="line">        transaction.addToBackStack(tag);</div><div class="line">        transaction.commit();</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SecondFragment</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@BindView</span>(R.id.btn_second)</div><div class="line">    Button mBtnSecond;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        View view = inflater.inflate(R.layout.fragment_second, container, <span class="keyword">false</span>);</div><div class="line">        ButterKnife.bind(<span class="keyword">this</span>, view);</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@OnClick</span>(R.id.btn_second)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewClicked</span><span class="params">()</span> </span>&#123;</div><div class="line">        showFragment(<span class="string">"ThirdFragment"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showFragment</span><span class="params">(String tag)</span> </span>&#123;</div><div class="line">        ThirdFragment thirdFragment = <span class="keyword">new</span> ThirdFragment();</div><div class="line">        FragmentManager manager = getFragmentManager();</div><div class="line">        FragmentTransaction transaction = manager.beginTransaction();</div><div class="line">        transaction.add(R.id.content_layout, thirdFragment, tag);</div><div class="line">        transaction.addToBackStack(tag);</div><div class="line">        transaction.commit();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>显示</p>
<p><img src="http://oq8w2ddi6.bkt.clouddn.com/fragment2.gif" alt=""></p>
<p>总体来说，我们调用addToBackStack(tag);将当前的事务添加到了回退栈，所以MainFragment实例不会被销毁，但是视图层次依然会被销毁，即会调用onDestoryView和onCreateView，但是使用add（）方法的SecondFragment视图层依然存在</p>


  </article>
  </script>
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <div class="busuanzi center">
    page PV:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    site PV:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    site UV:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>




    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot container">
    <div class="firstrow">
        <a href="#top" target="_self">
        <svg class="i-caret-right" viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M10 30 L26 16 10 2 Z"></path>
        </svg>
        </a>
        © Sweeney Di 2015-2017
    </div>
    <div class="secondrow">
        <a href="https://github.com/gaoryrt/hexo-theme-pln">
        Theme Pln
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.min.js"></script>
<script type="text/javascript">

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
